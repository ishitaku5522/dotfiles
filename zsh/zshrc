#!/usr/bin/env zsh

export EDITOR=vim
export MYDOTFILES=$HOME/dotfiles
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=59"
export PATH=$HOME/usr/bin:$PATH
echo -ne '\e]12;#aaaaaa\a'

setopt auto_cd

function chpwd() {ls}
function mails(){
    tmux source ~/dotfiles/tmux/mutt_tile
}

function hima(){
    i=1
    while :;do
        for j in $(seq 1 ${i});do
            echo -n æš‡ 
        done
        (( i++ ))
        echo
        sleep 1
    done
}

if [[ ! -n $TMUX ]]; then
    if [[ $TERM = 'xterm' ]]; then
        export TERM=xterm-256color
    fi

    if [[ `tmux list-sessions 2>/dev/null|wc -l` -ne 0 ]]; then
        exist_sessions=(`tmux list-sessions|sed "s/:.*//"`)
        attached_sessions=(`tmux list-sessions|grep attached|sed "s/:.*//"`)
        detached_sessions=(`tmux list-sessions|grep -v attached|sed "s/:.*//"`)
    fi

    if [[ $#exist_sessions -eq $#attached_sessions ]]; then
        idx=0
        while [[ -n ${exist_sessions[(re)$idx]} ]]; do
            (( idx++ ))
        done
        if [[ $TERM = 'linux' ]]; then
            tmux -2 new-session -s $idx
        else
            tmux new-session -s $idx
        fi
    else
        if [[ $TERM = 'linux' ]]; then
            tmux -2 attach -t ${detached_sessions[1]}
        else
            tmux attach -t ${detached_sessions[1]}
        fi
    fi
fi

if [[ -x "`which trash-put`" ]]; then
	alias rm="trash-put"
else
	echo "Recommended to install 'trash-cli'"
	to_trash() {
		for file in $@
		do
			mv $file ~/.trash
		done
	}
	alias rm="to_trash"
fi

if [[ -e "$HOME/localrcs/zsh-local.zsh" ]]; then
    source "$HOME/localrcs/zsh-local.zsh"
fi

gvim_call(){
    if [[ `\gvim --serverlist 2>/dev/null|wc -l` -ne 0 ]]; then
        \gvim --remote-tab-silent $*
    else
        \gvim $*
    fi

}

alias gvim=gvim_call $*
alias em="emacs"
alias dir="dir --group-directories-first --color=auto"

bindkey \^U backward-kill-line

zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
# zstyle ':completion:*' completer _complete _match _approximate
# zstyle ':completion:*' group-name ''
# zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# zstyle ':completion:*' use-cache true
# zstyle ':completion:*' verbose yes
# zstyle ':completion:*:default' menu select=2
# zstyle ':completion:*:descriptions' format '%F{yellow}-- %d --%f'
# zstyle ':completion:*:options' description 'yes'
