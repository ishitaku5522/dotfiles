set -g prefix      C-q
set -s escape-time 0
unbind-key C-b
bind-key   C-q send-prefix

# True color term
set -g  default-terminal   "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

set -g history-limit 100000 
set -g history-file ~/.tmux_history
set -g display-time 5000

# コピー関係
# setw   -g  mode-keys emacs
# bind   [   copy-mode \;             display "Copy mode"
# bind   -T  copy-mode C-Space        send    -X begin-selection
# bind   -T  copy-mode M-w            send    -X copy-pipe 'xsel -ip && xsel -op | xsel -ib'
# bind   ]   run       'tmux set-buffer -- "$(xsel -ob)"; tmux paste-buffer'
# bind   C-y run       'tmux set-buffer -- "$(xsel -ob)"; tmux paste-buffer'
# bind   -T copy-mode    MouseDrag1Pane send -X begin-selection
# unbind -T copy-mode    MouseDragEnd1Pane
# setw   -g mode-keys    vi
# bind   [  run          'tmux copy-mode; tmux display "Copy mode"'
# bind   -T copy-mode-vi Space          send -X begin-selection

# bind   -T copy-mode-vi Enter          send -X copy-pipe-and-cancel 'xsel -ip && xsel -op | xsel -ib'
# bind   ]  run          'tmux set-buffer -- "$(xsel -ob)"; tmux paste-buffer'
# bind   -T copy-mode-vi Enter          send -X copy-pipe-and-cancel 'pbcopy'
# bind   ]  run          'tmux set-buffer -- "$(pbpaste)"; tmux paste-buffer'

if-shell "uname | grep -q Darwin" \
"bind -T copy-mode-vi Enter send -X copy-pipe 'pbcopy'" \
"bind -T copy-mode-vi Enter send -X copy-pipe 'xsel -ip && xsel -op | xsel -ib'"

if-shell "uname | grep -q Darwin" \
"bind ] run 'tmux set-buffer -- \"$(pbpaste)\"; tmux paste-buffer'" \
"bind ] run 'tmux set-buffer -- \"$(xsel -ob)\"; tmux paste-buffer'"

# bind   -T copy-mode-vi MouseDrag1Pane send -X begin-selection
unbind -T copy-mode-vi MouseDragEnd1Pane


bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r H swap-pane   -U
bind -r J swap-pane   -D
bind -r K swap-pane   -U
bind -r L swap-pane   -D
bind -r '{' swap-pane   -U
bind -r '}' swap-pane   -D
bind -r + resize-pane -U 5
bind -r - resize-pane -D 5
bind -r > resize-pane -R 5
bind -r < resize-pane -L 5

bind c   new-window   -c  "#{pane_current_path}"
bind %   split-window -hc "#{pane_current_path}"
bind '"' split-window -vc "#{pane_current_path}"

bind 'M-~' join-pane -t:0
bind 'M-!' join-pane -t:1
bind 'M-"' join-pane -t:2
bind 'M-#' join-pane -t:3
bind 'M-$' join-pane -t:4
bind 'M-%' join-pane -t:5
bind 'M-&' join-pane -t:6
bind "M-'" join-pane -t:7
bind 'M-(' join-pane -t:8
bind 'M-)' join-pane -t:9
bind-key M-j command-prompt -p "join pane from:" "join-pane -s:%%"
bind-key M-k command-prompt -p "send pane to:" "join-pane -t:%%"

bind M-3 run '\tmux select-layout main-horizontal; HEIGHT=$(($(\tmux display-message -p -F "#{window_height}") / 2)); \tmux resize-pane -t 0 -y $HEIGHT'
bind M-4 run '\tmux select-layout main-vertical; WIDTH=$(($(\tmux display-message -p -F "#{window_width}") / 2)); \tmux resize-pane -t 0 -x $WIDTH'

if-shell '[ $(\tmux -V | cut -d" " -f2) = "master" ] || [ $(awk "BEGIN{ print $(\tmux -V | cut -d" " -f2 | cut -c 1-3) >= 2.1 }") -eq 1 ] || [ $(gawk "BEGIN{ print $(\tmux -V | cut -d" " -f2 | cut -c 1-3) >= 2.1 }") -eq 1 ]' \
'set -g mouse on' \
'set -g mode-mouse on; set -g mouse-resize-pane on; set -g mouse-select-pane on; set -g mouse-select-window on'

# ステータスラインまわり
source-file ~/localrcs/tmux-local
set -g base-index 1
set -g renumber-windows on
set -g status-position top
set -g status-interval 5

_tmux_color_bg='#282c34'
_tmux_color_fill_bg='#3e4452'
_tmux_color_fg='#abb2bf'
_tmux_color_number='#d19a66'
_tmux_color_string='#98c379'
_tmux_color_function='#61afef'
_tmux_color_comment='#5c6370'

# 全体のデザイン
set  -g status-style                "fg=$_tmux_color_fg,bg=$_tmux_color_bg"
# ステータスラインウィンドウ一覧デザイン
setw -g window-status-style         "fg=$_tmux_color_comment,bg=$_tmux_color_bg"
setw -g window-status-current-style "fg=$_tmux_color_number,bg=$_tmux_color_bg"
# ステータスライン左側デザイン
set  -g status-left-length 100
set  -g status-left "#[fg=$_tmux_color_function,bg=$_tmux_color_bg]#{?client_prefix,#[reverse],} [#S]#{host} "

_reset_color="#[fg=$_tmux_color_fg,bg=$_tmux_color_bg]"
# ステータスライン右側デザイン
set  -g status-right                "#[fg=$_tmux_color_string,bg=$_tmux_color_bg]\"#{=20:pane_title}\" %Y/%m/%d(%a)%T"
# set  -g status-right "CPU:#{cpu_fg_color}#{cpu_percentage}#{_reset_color}|#{sysstat_mem}|#{sysstat_swap}|BAT:#{battery_color_fg}#{battery_percentage}#{_reset_color}|%Y-%m-%d(%a)%T"
set  -g status-right-length         100

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
# set -g @plugin 'GROG/tmux-plugin-mem'
set -g @plugin 'samoshkin/tmux-plugin-sysstat'
set -g @plugin 'tmux-plugins/tmux-urlview'
run '~/.tmux/plugins/tpm/tpm'
# Template for local settings
# setw       -g clock-mode-colour     red
# set-option -g pane-active-border-fg red
